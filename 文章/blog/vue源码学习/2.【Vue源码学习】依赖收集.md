> 前面我们学习了vue的响应式原理，我们知道了vue2底层是通过`Object.defineProperty`来实现数据响应式的，但是单有这个还不够，我们在data中定义的数据可能没有用于模版渲染，修改这些数据同样会出发setter导致重新渲染，所以vue在这里做了优化，通过收集依赖来判断哪些数据的变更需要触发视图更新。

## 前言

如果这篇文章有帮助到你，❤️关注+点赞❤️鼓励一下作者，文章公众号首发，关注 **前端南玖** 第一时间获取最新的文章～

**我们先来考虑两个问题：**

- 1.我们如何知道哪里用了data里面的数据？

- 2.数据变更了，如何通知render更新视图？

我们可以来看下官方介绍图，这里的`collect as Dependency`就是源码中的`dep.depend()`依赖收集，`Notify`就是源码中的`deep.notify()`通知订阅者

![preview](/Users/admin/Documents/宋瑶/study_pic/8/vue/响应式原理.png)

## 依赖收集中的各个类

Vue源码中负责依赖收集的类有三个：

- Observer：`可观测类`，将数组/对象转成可观测数据，每个`Observer`的实例成员中都有一个`Dep`的实例（上一篇文章实现过这个类）

- Dep：`观察目标类`，每一个数据都会有一个`Dep`类实例，它内部有个subs队列，subs就是subscribers的意思，保存着依赖本数据的`观察者`，当本数据变更时，调用`dep.notify()`通知观察者 
- Watcher：`观察者类`，进行`观察者函数`的包装处理。如`render()`函数，会被进行包装成一个`Watcher`实例 

依赖就是`Watcher`,只有`Watcher`触发的`getter`才会收集依赖，哪个`Watcher`触发了`getter`，就把哪个`watcher`收集到`Dep`中。Dep使用发布订阅模式，当数据发生变化时，会循环依赖列表，把所有的`watcher`都通知一遍

