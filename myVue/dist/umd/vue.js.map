{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe/array.js","../../src/observe/dep.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(data){\n    return !(typeof data !== 'object' && data !== null)\n}\n\nexport function def(data,key,value){\n    Object.defineProperty(data,key,{\n        enumerable:false,\n        configurable:false,\n        value\n    })\n}","\n// 重写数组的7个方法： push,pop,shift,unshift,reverse,sort,splice会导致数组本身改变\n\nlet oldArrayMethods = Array.prototype\n// value.__proto__ = arrayMethods \n// arrayMethods.__proto__ = oldArrayMethods\nexport let arrayMethods = Object.create(oldArrayMethods)\n\nconst methods = [\n    'push','pop','shift','unshift','reverse','sort','splice'\n]\n\nmethods.forEach(method=>{\n    arrayMethods[method] = function(...args) {\n        console.log('用户调用了：'+method,args)\n        const res = oldArrayMethods[method].apply(this, args) // 调用原生数组方法\n        // 添加的元素可能还是一个对象\n\n        let inserted = args //当前插入的元素\n        //数组新插入的元素需要重新进行observe才能响应式\n        let ob = this.__ob__\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args\n                break;\n            case 'splice':\n                inserted = args.slice(2)\n                break;\n            default:\n                break;\n        }\n        if(inserted) {\n            ob.observerArray(inserted)  //将新增属性继续\n        }\n\n        console.log('数组更新了：'+ JSON.stringify(inserted))\n        //通知所有注册的观察者进行响应式处理\n        ob.dep.notify() \n        return res\n    }\n})\n\n","\n\nexport default class Dep {\n    constructor() {\n        this.subs = []\n    }\n\n    //收集观察者\n    addSub(watcher) {\n        this.subs.push(watcher)\n    }\n    //通知观察者去更新\n    notify() {\n        console.log('通知观察者更新～')\n        this.subs.forEach(w=>w.update())\n    }\n}","// 把data中数据使用Object.defineProperty重新定义 es5\n// Object.defineProperty 不能兼容IE8及以下，所以vue2无法兼容IE8版本\nimport {isObject,def} from \"../util/index\"\nimport {arrayMethods} from \"./array.js\"\nimport Dep from \"./dep\"\nexport function observe (data) {\n    // console.log(data,'observe')\n    let isObj = isObject(data)\n    if(!isObj) return \n    return new Observer(data) // 观测数据\n}\n\n class Observer {\n     constructor(v){\n         // 每一个Observer实例身上都有一个Dep实例\n         this.dep = new Dep()\n        // 如果数据层次过多，需要递归去解析对象中的属性，依次增加set和get方法\n        def(v,'__ob__',this)  //给数据挂上__ob__属性，表明已观测\n        if(Array.isArray(v)) {\n            // 把重写的数组方法重新挂在数组原型上\n            v.__proto__ = arrayMethods\n            // 如果数组里放的是对象，再进行监测\n            this.observerArray(v)\n        }else{\n            // 非数组就直接调用defineReactive将数据定义成响应式对象\n            this.walk(v)\n        }\n        \n     }\n     observerArray(value) {\n         for(let i=0; i<value.length;i++) {\n             observe(value[i])\n         }\n     }\n     walk(data) {\n         let keys = Object.keys(data); //获取对象key\n         keys.forEach(key => {\n            defineReactive(data,key,data[key]) // 定义响应式对象\n         })\n     }\n }\n\n function  defineReactive(data,key,value){\n     const dep = new Dep() //实例化dep,用于收集依赖，通知订阅者更新\n     observe(value) // 递归实现深度监测，注意性能\n     Object.defineProperty(data,key,{\n         configurable:true,\n         enumerable:true,\n         get(){\n             //获取值\n            //  依赖收集\n            return value\n         },\n         set(newV) {\n             //设置值\n            if(newV === value) return\n            observe(newV) //继续劫持newV,用户有可能设置的新值还是一个对象\n            value = newV\n            console.log('值变化了:',value)\n            // 发布订阅模式，通知\n            dep.notify()\n            // cb() //订阅者收到消息回调\n         }\n     })\n }","import {observe} from \"./observe/index\"\nexport function proxy (target,sourceKey,key) {\n    // target: 想要代理到的目标对象，sourceKey：想要代理的对象\n    const _that = this\n    Object.defineProperty(target, key, {\n        enumerable: true,\n        configurable: true,\n        get: function(){\n            return _that[sourceKey][key]\n        },\n        set: function(v){\n            _that[sourceKey][key] = v\n        }\n    })\n}\n\nexport function initState(vm) {\n    const opts = vm.$options;\n    // vue的数据来源 属性 方法 数据 计算属性 watch\n    // console.log(opts)\n    if(opts.props){\n        initProps(vm)\n    }\n    if(opts.methods){\n        initMethods(vm)\n    }\n    if(opts.data){\n        initData(vm)\n    }\n    if(opts.computed){\n        initComputed(vm)\n    }\n    if(opts.watch){\n        initWatch(vm)\n    }\n}\nfunction initProps(vm) {}\nfunction initMethods(vm) {}\nfunction initData(vm) {\n    // console.log('初始化数据',vm.$options.data)\n    // 数据初始化\n    let data = vm.$options.data;\n    data = vm._data =  typeof data === 'function' ? data.call(this) : data\n    // 对象劫持，用户改变了数据 ==》 刷新页面\n    // MVVM模式 数据驱动视图\n    Object.keys(data).forEach(i => {\n        proxy.call(vm,vm,'_data',i)\n    })\n    // Object.definePropety() 给属性增加get和set方法\n    observe(data)  //响应式原理\n}\nfunction initComputed(vm) {}\nfunction initWatch(vm) {}","// ast语法数，用对象来描述原生语法\n\n// Regular Expressions for parsing tags and attributes\nconst singleAttrIdentifier = /([^\\s\"'<>/=]+)/\nconst singleAttrAssign = /(?:=)/\nconst singleAttrValues = [\n  // attr value double quotes\n  /\"([^\"]*)\"+/.source,\n  // attr value, single quotes\n  /'([^']*)'+/.source,\n  // attr value, no quotes\n  /([^\\s\"'=<>`]+)/.source\n]\nconst attribute = new RegExp(\n  '^\\\\s*' + singleAttrIdentifier.source +\n  '(?:\\\\s*(' + singleAttrAssign.source + ')' +\n  '\\\\s*(?:' + singleAttrValues.join('|') + '))?'\n)\n/*Github:https://github.com/answershuto*/\n// could use https://www.w3.org/TR/1999/REC-xml-names-19990114/#NT-QName\n// but for Vue templates we can enforce a simple charset\nconst ncname = '[a-zA-Z_][\\\\w\\\\-\\\\.]*'\nconst qnameCapture = '((?:' + ncname + '\\\\:)?' + ncname + ')'\nconst startTagOpen = new RegExp('^<' + qnameCapture)\nconst startTagClose = /^\\s*(\\/?)>/\nconst endTag = new RegExp('^<\\\\/' + qnameCapture + '[^>]*>')\n/*匹配<!DOCTYPE> 标签*/\nconst doctype = /^<!DOCTYPE [^>]+>/i\n/*匹配注释*/\nconst comment = /^<!--/\nconst conditionalComment = /^<!\\[/\nexport function compileToFunction(template) {\n        return function render() {\n\n        }\n}","import {initState} from \"./state\"\nimport {compileToFunction} from \"./compiler/index\"\n\nexport function initMixin(Vue){\n    // 初始化流程\n    Vue.prototype._init = function (options){\n        // console.log(options)\n        // 数据劫持\n        const vm = this // vue中使用this.$options\n        vm.$options = options\n\n        // 初始化状态\n        initState(vm)\n\n        //如果页面传入了el,需要将页面渲染出来\n        //如果传入了el，就要实现挂载流程\n        if(vm.$options.el){\n            vm.$mount(vm.$options.el)\n        }\n    }\n    Vue.prototype.$mount = function (el){\n        const vm = this\n        const options = vm.$options\n        el = document.querySelector(el)\n\n        // 默认会先查找render方法，没有render会采用template，template也没有就会使用el中的内容\n        if(!options.render) {\n            // 对模版进行编译\n            let template = options.template\n            if(!template && el){\n                template = el.outerHTML\n            }\n            // console.log(template)\n            //我们需要将template 转化成render方法 \n            const render = compileToFunction(template)\n            options.render = render\n        }\n    }\n}","import {initMixin} from \"./init\"\n// Vue的声明\nfunction Vue(options) {\n\n    // 进行Vue的初始化操作\n    this._init(options)\n}\n\ninitMixin(Vue) // 给Vue原型上添加_init方法\n\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","console","log","res","apply","inserted","ob","__ob__","slice","observerArray","JSON","stringify","dep","notify","Dep","subs","watcher","push","w","update","observe","isObj","Observer","v","isArray","__proto__","walk","i","length","keys","defineReactive","get","set","newV","proxy","target","sourceKey","_that","initState","vm","opts","$options","props","initData","computed","watch","_data","call","compileToFunction","template","render","initMixin","Vue","_init","options","el","$mount","document","querySelector"],"mappings":"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"}